<header class="app-header">
  <div class="header-content">
    <!-- å·¦å´ï¼šè¿”å›æŒ‰éˆ•ã€Logo/æ¨™é¡Œ -->
    <div class="header-left">
      <button class="btn-back" *ngIf="showBackButton()" (click)="goBack()" title="è¿”å›">
        â† è¿”å›
      </button>
      <button class="logo-btn" (click)="goToDashboard()" title="è¿”å›é¦–é ">
        <h1>å°ˆæ¡ˆç®¡ç†ç³»çµ±</h1>
      </button>
    </div>

    <!-- ä¸­é–“ï¼šæœå°‹æ¡† -->
    <div class="header-center">
      <div class="search-container">
        <input
          type="text"
          class="search-input"
          placeholder="æœå°‹ä»»å‹™ã€å°ˆæ¡ˆã€å·¥ä½œå€... (æŒ‰ Cmd+K)"
          [(ngModel)]="searchQuery"
          (focus)="onSearchFocus()"
          (blur)="onSearchBlur()"
          (input)="onSearchInput()"
          (keydown)="onSearchKeydown($event)"
          #searchInput
        />
        <span class="search-icon" (click)="onSearchIconClick()" title="æœå°‹">ğŸ”</span>
        <div class="search-suggestions" *ngIf="showSuggestions() && searchSuggestions().length > 0">
          <div
            class="suggestion-item"
            *ngFor="let suggestion of searchSuggestions(); let i = index"
            [class.active]="selectedSuggestionIndex() === i"
            (click)="selectSuggestion(suggestion)"
            (mouseenter)="selectedSuggestionIndex.set(i)"
          >
            <span class="suggestion-icon">
              {{ suggestion.type === 'task' ? 'ğŸ“‹' : suggestion.type === 'project' ? 'ğŸ“' : 'ğŸ¢' }}
            </span>
            <div class="suggestion-content">
              <div class="suggestion-title">{{ suggestion.title }}</div>
              <div class="suggestion-subtitle" *ngIf="suggestion.subtitle">{{ suggestion.subtitle }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å³å´ï¼šé€šçŸ¥å’Œç”¨æˆ¶è³‡è¨Š -->
    <div class="header-right">
      <app-notification-center></app-notification-center>
      <div class="user-menu-container" *ngIf="currentUser()">
        <button class="user-menu-trigger" (click)="toggleUserMenu()" [class.active]="showUserMenu()">
          <div class="user-avatar" *ngIf="currentUser()?.avatarUrl">
            <img [src]="currentUser()?.avatarUrl" [alt]="currentUser()?.fullName || 'ä½¿ç”¨è€…'">
          </div>
          <div class="user-avatar-placeholder" *ngIf="!currentUser()?.avatarUrl">
            {{ getInitials(currentUser()?.fullName || '') }}
          </div>
        </button>
        <div class="user-menu-dropdown" *ngIf="showUserMenu()" (click)="$event.stopPropagation()">
          <div class="user-menu-header">
            <div class="user-avatar-large" *ngIf="currentUser()?.avatarUrl">
              <img [src]="currentUser()?.avatarUrl" [alt]="currentUser()?.fullName || 'ä½¿ç”¨è€…'">
            </div>
            <div class="user-avatar-large-placeholder" *ngIf="!currentUser()?.avatarUrl">
              {{ getInitials(currentUser()?.fullName || '') }}
            </div>
            <div class="user-menu-info">
              <div class="user-menu-name">{{ currentUser()?.fullName || 'ä½¿ç”¨è€…' }}</div>
              <div class="user-menu-email">{{ currentUser()?.email || '' }}</div>
            </div>
          </div>
          <div class="user-menu-divider"></div>
          <div class="user-menu-items">
            <button class="user-menu-item" disabled title="å³å°‡æ¨å‡º">
              <span class="menu-icon">âš™ï¸</span>
              <span>å€‹äººè¨­å®š</span>
            </button>
            <button class="user-menu-item" disabled title="å³å°‡æ¨å‡º">
              <span class="menu-icon">ğŸ”„</span>
              <span>åˆ‡æ›å·¥ä½œå€</span>
            </button>
            <div class="user-menu-divider"></div>
            <button class="user-menu-item user-menu-item-danger" (click)="logout()">
              <span class="menu-icon">ğŸšª</span>
              <span>ç™»å‡º</span>
            </button>
          </div>
        </div>
      </div>
      <div class="user-info-loading" *ngIf="!currentUser()">
        <div class="user-avatar-placeholder">U</div>
        <span class="user-name">è¼‰å…¥ä¸­...</span>
      </div>
    </div>
  </div>
</header>
