<div class="search-results-container">
  <div class="search-header">
    <h1>æœå°‹çµæœ</h1>
    <div class="search-query" *ngIf="searchQuery()">
      <span class="query-label">æœå°‹é—œéµå­—ï¼š</span>
      <span class="query-text">{{ searchQuery() }}</span>
    </div>
  </div>

  <!-- é¡å‹åˆ‡æ› -->
  <div class="search-filters">
    <button
      class="filter-btn"
      [class.active]="searchType() === 'all'"
      (click)="onTypeChange('all')"
    >
      å…¨éƒ¨
    </button>
    <button
      class="filter-btn"
      [class.active]="searchType() === 'tasks'"
      (click)="onTypeChange('tasks')"
    >
      ä»»å‹™ ({{ totalCounts().tasks }})
    </button>
    <button
      class="filter-btn"
      [class.active]="searchType() === 'projects'"
      (click)="onTypeChange('projects')"
    >
      å°ˆæ¡ˆ ({{ totalCounts().projects }})
    </button>
    <button
      class="filter-btn"
      [class.active]="searchType() === 'workspaces'"
      (click)="onTypeChange('workspaces')"
    >
      å·¥ä½œå€ ({{ totalCounts().workspaces }})
    </button>
  </div>

  <!-- è¼‰å…¥ä¸­ -->
  <div class="loading" *ngIf="loading()">
    <div class="spinner"></div>
    <p>æœå°‹ä¸­...</p>
  </div>

  <!-- éŒ¯èª¤è¨Šæ¯ -->
  <div class="error" *ngIf="error()">
    <p>{{ error() }}</p>
  </div>

  <!-- æœå°‹çµæœ -->
  <div class="search-results" *ngIf="!loading() && !error() && searchResults()">
    <!-- ä»»å‹™çµæœ -->
    <section class="results-section" *ngIf="(searchType() === 'all' || searchType() === 'tasks') && searchResults()!.tasks.length > 0">
      <h2>ä»»å‹™ ({{ searchResults()!.tasks.length }})</h2>
      <div class="results-list">
        <div class="result-item task-item" *ngFor="let task of searchResults()!.tasks" [routerLink]="['/tasks', task.id]">
          <div class="result-icon">ğŸ“‹</div>
          <div class="result-content">
            <div class="result-title">{{ task.title }}</div>
            <div class="result-meta">
              <span class="status-badge" [class]="'status-' + task.status">
                {{ getStatusLabel(task.status) }}
              </span>
              <span class="priority-badge" *ngIf="task.priority" [class]="getPriorityClass(task.priority)">
                {{ getPriorityLabel(task.priority) }}
              </span>
              <span class="meta-text" *ngIf="task.project_name">
                {{ task.project_name }}
              </span>
              <span class="meta-text" *ngIf="task.workspace_name">
                Â· {{ task.workspace_name }}
              </span>
            </div>
            <div class="result-description" *ngIf="task.description">
              {{ task.description }}
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- å°ˆæ¡ˆçµæœ -->
    <section class="results-section" *ngIf="(searchType() === 'all' || searchType() === 'projects') && searchResults()!.projects.length > 0">
      <h2>å°ˆæ¡ˆ ({{ searchResults()!.projects.length }})</h2>
      <div class="results-list">
        <div class="result-item project-item" *ngFor="let project of searchResults()!.projects" [routerLink]="['/projects', project.id, 'board']">
          <div class="result-icon" [style.color]="project.color || '#4A90E2'">ğŸ“</div>
          <div class="result-content">
            <div class="result-title">{{ project.name }}</div>
            <div class="result-meta">
              <span class="meta-text" *ngIf="project.workspace_name">
                {{ project.workspace_name }}
              </span>
              <span class="meta-text" *ngIf="project.task_count !== undefined">
                Â· {{ project.task_count }} å€‹ä»»å‹™
              </span>
            </div>
            <div class="result-description" *ngIf="project.description">
              {{ project.description }}
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- å·¥ä½œå€çµæœ -->
    <section class="results-section" *ngIf="(searchType() === 'all' || searchType() === 'workspaces') && searchResults()!.workspaces.length > 0">
      <h2>å·¥ä½œå€ ({{ searchResults()!.workspaces.length }})</h2>
      <div class="results-list">
        <div class="result-item workspace-item" *ngFor="let workspace of searchResults()!.workspaces" [routerLink]="['/workspaces', workspace.id]">
          <div class="result-icon">ğŸ¢</div>
          <div class="result-content">
            <div class="result-title">{{ workspace.name }}</div>
            <div class="result-meta">
              <span class="meta-text" *ngIf="workspace.owner_name">
                æ“æœ‰è€…ï¼š{{ workspace.owner_name }}
              </span>
              <span class="meta-text" *ngIf="workspace.project_count !== undefined">
                Â· {{ workspace.project_count }} å€‹å°ˆæ¡ˆ
              </span>
              <span class="meta-text" *ngIf="workspace.member_count !== undefined">
                Â· {{ workspace.member_count }} ä½æˆå“¡
              </span>
            </div>
            <div class="result-description" *ngIf="workspace.description">
              {{ workspace.description }}
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ç„¡çµæœ -->
    <div class="no-results" *ngIf="searchResults()!.total === 0">
      <p>æ²’æœ‰æ‰¾åˆ°ç›¸é—œçµæœ</p>
      <p class="hint">è«‹å˜—è©¦ä½¿ç”¨ä¸åŒçš„é—œéµå­—æˆ–æª¢æŸ¥æ‹¼å¯«</p>
    </div>
  </div>
</div>

