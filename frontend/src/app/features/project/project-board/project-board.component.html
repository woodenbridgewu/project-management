<div class="board-container">
  <div class="board-header">
    <div class="header-left">
      <button class="btn-back" (click)="goBack()">â† è¿”å›</button>
      <h2>{{ projectName() || 'çœ‹æ¿è¦–åœ–' }}</h2>
    </div>
    <button class="btn-primary" (click)="showCreateSectionModal = true">
      + æ–°å¢å€æ®µ
    </button>
  </div>
  
  <div class="board" cdkDropListGroup *ngIf="sections().length > 0; else emptyState">
    @for (section of sections(); track section.id) {
      <div class="board-column">
        <div class="column-header">
          <div class="column-title">
            <h3>{{ section.name }}</h3>
            <span class="task-count">{{ section.task_count || section.tasks?.length || 0 }}</span>
          </div>
          <div class="column-actions" (click)="$event.stopPropagation()">
            <button class="btn-icon" (click)="editSection(section)">âœï¸</button>
            <button class="btn-icon" (click)="deleteSection(section.id)">ğŸ—‘ï¸</button>
          </div>
        </div>
        
        <div 
          class="column-content"
          cdkDropList
          [id]="section.id"
          [cdkDropListData]="section.tasks || []"
          (cdkDropListDropped)="onDrop($event)">
          
          @for (task of section.tasks || []; track task.id) {
            <div class="task-card-wrapper" cdkDrag>
              <app-task-card 
                [task]="task"
                (taskClick)="openTaskDetail(task)"
                (taskEdit)="editTask(task)"
                (taskDelete)="deleteTask(task)">
              </app-task-card>
            </div>
          }
          
          <button class="add-task-btn" (click)="addTask(section.id)">
            + æ–°å¢ä»»å‹™
          </button>
        </div>
      </div>
    }
  </div>

  <ng-template #emptyState>
    <div class="empty-state">
      <div class="empty-icon">ğŸ“‹</div>
      <h3>é‚„æ²’æœ‰å€æ®µ</h3>
      <p>å»ºç«‹ç¬¬ä¸€å€‹å€æ®µä¾†é–‹å§‹ç®¡ç†ä»»å‹™</p>
      <button class="btn-primary" (click)="showCreateSectionModal = true">å»ºç«‹å€æ®µ</button>
    </div>
  </ng-template>
</div>

<!-- å»ºç«‹/ç·¨è¼¯å€æ®µæ¨¡æ…‹æ¡† -->
<div class="modal-overlay" *ngIf="showCreateSectionModal || editingSection" (click)="closeSectionModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editingSection ? 'ç·¨è¼¯å€æ®µ' : 'å»ºç«‹å€æ®µ' }}</h2>
      <button class="btn-close" (click)="closeSectionModal()">Ã—</button>
    </div>
    <form (ngSubmit)="saveSection()" class="modal-form">
      <div class="form-group">
        <label for="section-name">åç¨± *</label>
        <input 
          type="text" 
          id="section-name" 
          [(ngModel)]="sectionForm.name" 
          name="section-name"
          required
          placeholder="è¼¸å…¥å€æ®µåç¨±"
        />
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeSectionModal()">å–æ¶ˆ</button>
        <button type="submit" class="btn-primary" [disabled]="loading() || !sectionForm.name">
          {{ loading() ? 'è™•ç†ä¸­...' : (editingSection ? 'æ›´æ–°' : 'å»ºç«‹') }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- å»ºç«‹ä»»å‹™æ¨¡æ…‹æ¡† -->
<div class="modal-overlay" *ngIf="showCreateTaskModal" (click)="closeTaskModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>å»ºç«‹ä»»å‹™</h2>
      <button class="btn-close" (click)="closeTaskModal()">Ã—</button>
    </div>
    <form (ngSubmit)="saveTask()" class="modal-form">
      <div class="form-group">
        <label for="task-title">æ¨™é¡Œ *</label>
        <input 
          type="text" 
          id="task-title" 
          [(ngModel)]="taskForm.title" 
          name="task-title"
          required
          placeholder="è¼¸å…¥ä»»å‹™æ¨™é¡Œ"
        />
      </div>
      <div class="form-group">
        <label for="task-description">æè¿°</label>
        <textarea 
          id="task-description" 
          [(ngModel)]="taskForm.description" 
          name="task-description"
          rows="3"
          placeholder="è¼¸å…¥ä»»å‹™æè¿°ï¼ˆé¸å¡«ï¼‰"
        ></textarea>
      </div>
      <div class="form-group">
        <label for="task-priority">å„ªå…ˆç´š</label>
        <select id="task-priority" [(ngModel)]="taskForm.priority" name="task-priority">
          <option value="">ç„¡</option>
          <option value="low">ä½</option>
          <option value="medium">ä¸­</option>
          <option value="high">é«˜</option>
          <option value="urgent">ç·Šæ€¥</option>
        </select>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeTaskModal()">å–æ¶ˆ</button>
        <button type="submit" class="btn-primary" [disabled]="loading() || !taskForm.title">
          {{ loading() ? 'è™•ç†ä¸­...' : 'å»ºç«‹' }}
        </button>
      </div>
    </form>
  </div>
</div>

