<div class="task-list-container">
  <div class="task-list-header">
    <h2>任務列表</h2>
    <button (click)="openCreateTaskDialog()" class="btn-primary">
      + 新增任務
    </button>
  </div>
  
  <div class="filters">
    <div class="filter-group">
      <label>狀態</label>
      <select [(ngModel)]="filters.status" (change)="applyFilters()">
        <option value="">所有狀態</option>
        <option value="todo">待辦</option>
        <option value="in_progress">進行中</option>
        <option value="review">審核中</option>
        <option value="done">已完成</option>
      </select>
    </div>
    <div class="filter-group">
      <label>區段</label>
      <select [(ngModel)]="filters.sectionId" (change)="applyFilters()">
        <option value="">所有區段</option>
        @for (section of sections(); track section.id) {
          <option [value]="section.id">{{ section.name }}</option>
        }
      </select>
    </div>
    <button class="btn-clear" (click)="clearFilters()">清除篩選</button>
  </div>
  
  @if (loading()) {
    <div class="loading">載入中...</div>
  } @else {
    <div class="tasks">
      @for (task of filteredTasks(); track task.id) {
        <app-task-card 
          [task]="task"
          (taskClick)="openTaskDetail(task)"
          (taskUpdate)="onTaskUpdate($event)">
        </app-task-card>
      } @empty {
        <div class="empty-state">
          <p>尚無任務，開始建立第一個任務吧！</p>
        </div>
      }
    </div>
  }
</div>

<!-- 建立任務模態框 -->
<div class="modal-overlay" *ngIf="showCreateTaskModal" (click)="closeTaskModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>建立任務</h2>
      <button class="btn-close" (click)="closeTaskModal()">×</button>
    </div>
    <form (ngSubmit)="saveTask()" class="modal-form">
      <div class="form-group">
        <label for="task-title">標題 *</label>
        <input 
          type="text" 
          id="task-title" 
          [(ngModel)]="taskForm.title" 
          name="task-title"
          required
          placeholder="輸入任務標題"
        />
      </div>
      <div class="form-group">
        <label for="task-description">描述</label>
        <textarea 
          id="task-description" 
          [(ngModel)]="taskForm.description" 
          name="task-description"
          rows="3"
          placeholder="輸入任務描述（選填）"
        ></textarea>
      </div>
      <div class="form-group">
        <label for="task-section">區段</label>
        <select id="task-section" [(ngModel)]="taskForm.sectionId" name="task-section">
          <option value="">未分類</option>
          @for (section of sections(); track section.id) {
            <option [value]="section.id">{{ section.name }}</option>
          }
        </select>
      </div>
      <div class="form-group">
        <label for="task-priority">優先級</label>
        <select id="task-priority" [(ngModel)]="taskForm.priority" name="task-priority">
          <option value="">無</option>
          <option value="low">低</option>
          <option value="medium">中</option>
          <option value="high">高</option>
          <option value="urgent">緊急</option>
        </select>
      </div>
      <div class="form-group">
        <label for="task-due-date">截止日期</label>
        <input 
          type="datetime-local" 
          id="task-due-date" 
          [(ngModel)]="taskForm.dueDate" 
          name="task-due-date"
        />
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeTaskModal()">取消</button>
        <button type="submit" class="btn-primary" [disabled]="loading() || !taskForm.title">
          {{ loading() ? '建立中...' : '建立' }}
        </button>
      </div>
    </form>
  </div>
</div>

